<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TempMail Dashboard</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
body { font-family: sans-serif; padding: 20px; background:#f4f4f4; }
#accounts .account-card { background:white; padding:15px; margin-bottom:15px; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.1);}
.account-card .email-address { font-weight:bold; font-size:16px; }
.icon-btn { cursor:pointer; margin-left:5px; border:none; background:none; }
.inbox-section { margin-top:10px; }
.email-item { padding:5px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; }
.email-item.new { background:#e0ffe0; }
.otp-badge { background: #4caf50; color:white; padding:2px 6px; border-radius:4px; font-size:12px; }
.empty-state { text-align:center; color:#888; }
</style>
</head>
<body>

<h2>TempMail Dashboard</h2>
<div>
    <input type="text" id="prefix" placeholder="Email prefix (optional)">
    <input type="number" id="count" value="1" min="1" max="5">
    <button onclick="generateMultiple()">Generate</button>
    <button onclick="clearAll()">Clear All</button>
</div>
<p>Total Accounts: <span id="totalAccounts">0</span> | Total Emails: <span id="totalEmails">0</span></p>

<div id="accounts">
    <div class="empty-state" id="emptyState">
        <i class="fas fa-inbox" style="font-size:40px;"></i>
        <p>No Accounts Yet</p>
    </div>
</div>

<script>
let accounts = [];

function rand(len=6){
    const chars = "abcdefghijklmnopqrstuvwxyz0123456789";
    let result = "";
    for(let i=0;i<len;i++) result+=chars[Math.floor(Math.random()*chars.length)];
    return result;
}

async function generateMultiple(){
    const count = parseInt(document.getElementById("count").value)||1;
    const prefix = document.getElementById("prefix").value.trim();

    for(let i=0;i<count;i++){
        await createAccount(prefix);
        await new Promise(r=>setTimeout(r, 200));
    }
}

async function createAccount(customPrefix){
    try{
        // 1secmail API generate email
        const name = customPrefix || rand(6);
        const domains = ["1secmail.com","1secmail.org","1secmail.net"];
        const domain = domains[Math.floor(Math.random()*domains.length)];
        const email = `${name}@${domain}`;

        addUI(email);
        return true;
    }catch(e){
        console.error("Failed to create email:",e);
        return false;
    }
}

function addUI(email){
    const container = document.getElementById("accounts");
    const id = email.replace(/[@.]/g,'-');

    if(document.getElementById(`card-${id}`)) return;

    const card = document.createElement('div');
    card.className='account-card';
    card.id=`card-${id}`;
    card.innerHTML=`
        <div class="email-address">${email}
            <button class="icon-btn" onclick="copyEmail('${email}', this)"><i class="fas fa-copy"></i></button>
            <button class="icon-btn" onclick="removeAccount('${email}')"><i class="fas fa-trash"></i></button>
        </div>
        <div class="inbox-section">
            <div class="inbox-container" id="inbox-${id}">
                <div class="empty-state">No messages yet.</div>
            </div>
        </div>
    `;
    container.insertBefore(card, container.firstChild);

    const account = {
        email,
        inbox: [],
        inboxDiv: card.querySelector(`#inbox-${id}`),
        intervalId: setInterval(()=>checkInbox(account), 5000)
    };

    accounts.push(account);
    updateStats();
}

async function checkInbox(account){
    const [user, domain] = account.email.split("@");
    try{
        const res = await fetch(`https://www.1secmail.com/api/v1/?action=getMessages&login=${user}&domain=${domain}`);
        const messages = await res.json();

        messages.forEach(msg=>{
            if(!account.inbox.some(m=>m.id===msg.id)){
                const messageData={
                    id: msg.id,
                    from: msg.from,
                    subject: msg.subject,
                    time: new Date(msg.date).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})
                };
                account.inbox.unshift(messageData);
            }
        });

        updateInbox(account);
        updateStats();
    }catch(e){
        console.log("Error checking inbox:",e);
    }
}

function updateInbox(account){
    if(account.inbox.length===0){
        account.inboxDiv.innerHTML='<div class="empty-state">No messages yet.</div>';
        return;
    }

    let html='';
    account.inbox.slice(0,5).forEach(msg=>{
        const otp = msg.subject.match(/\b\d{4,8}\b/) || msg.from.match(/\b\d{4,8}\b/);
        html+=`<div class="email-item">
            <div><strong>${msg.from}</strong> - ${msg.subject}</div>
            <div>${otp? `<span class="otp-badge">${otp[0]}</span>`:msg.time}</div>
        </div>`;
    });

    account.inboxDiv.innerHTML=html;
}

function copyEmail(email, btn){
    navigator.clipboard.writeText(email);
    btn.innerHTML='<i class="fas fa-check"></i>';
    setTimeout(()=>{btn.innerHTML='<i class="fas fa-copy"></i>';},2000);
}

function removeAccount(email){
    const index = accounts.findIndex(a=>a.email===email);
    if(index!==-1){
        clearInterval(accounts[index].intervalId);
        accounts.splice(index,1);
        const card=document.getElementById(`card-${email.replace(/[@.]/g,'-')}`);
        if(card) card.remove();
        updateStats();
    }
}

function clearAll(){
    accounts.forEach(a=>clearInterval(a.intervalId));
    accounts=[];
    document.getElementById('accounts').innerHTML='<div class="empty-state">No Accounts Yet</div>';
    updateStats();
}

function updateStats(){
    document.getElementById('totalAccounts').textContent=accounts.length;
    const totalEmails=accounts.reduce((sum,a)=>sum+a.inbox.length,0);
    document.getElementById('totalEmails').textContent=totalEmails;
}
</script>
</body>
</html>
